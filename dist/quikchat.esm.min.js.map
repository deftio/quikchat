{"version":3,"file":"quikchat.esm.min.js","sources":["../src/quikchat.js"],"sourcesContent":["class quikchat {\n    /**\n     * \n     * @param string or DOM element  parentElement \n     * @param {*} meta \n     */\n    constructor(parentElement, onSend = () => { }, options = {}) {\n        const defaultOpts = {\n            theme: 'quikchat-theme-light',\n            trackHistory: true,\n            titleArea: { title: \"Chat\", show: false, align: \"center\" },\n            messagesArea: { alternating: true },\n            inputArea: { show: true },\n            sendOnEnter: true,\n            sendOnShiftEnter: false,\n            instanceClass: ''\n        };\n        const meta = { ...defaultOpts, ...options }; // merge options with defaults\n\n        if (typeof parentElement === 'string') {\n            parentElement = document.querySelector(parentElement);\n        }\n        //console.log(parentElement, meta);\n        this._parentElement = parentElement;\n        this._theme = meta.theme;\n        this._onSend = onSend ? onSend : () => { }; // call back function for onSend\n        this._createWidget();\n\n        if (meta.instanceClass) {\n            this._chatWidget.classList.add(meta.instanceClass);\n        }\n\n        // title area\n        if (meta.titleArea) {\n            this.titleAreaSetContents(meta.titleArea.title, meta.titleArea.align);\n            if (meta.titleArea.show === true) {\n                this.titleAreaShow();\n            } else {\n                this.titleAreaHide();\n            }\n        }\n        // messages area\n        if (meta.messagesArea) {\n            this.messagesAreaAlternateColors(meta.messagesArea.alternating);\n        }\n\n        // input area\n        if (meta.inputArea) {\n            if (meta.inputArea.show === true)\n                this.inputAreaShow();\n            else\n                this.inputAreaHide();\n        }\n        // plumbing\n        this._attachEventListeners();\n        this.trackHistory = meta.trackHistory || true;\n        this._historyLimit = 10000000;\n        this._history = [];\n        this._activeTags = new Set();\n\n        // send on enter / shift enter\n        this.sendOnEnter = meta.sendOnEnter;\n        this.sendOnShiftEnter = meta.sendOnShiftEnter;\n    }\n\n    _createWidget() {\n        const widgetHTML =\n            `\n            <div class=\"quikchat-base ${this.theme}\">\n                <div class=\"quikchat-title-area\">\n                    <span style=\"font-size: 1.5em; font-weight: 600;\">Title Area</span>\n                </div>\n                <div class=\"quikchat-messages-area\"></div>\n                <div class=\"quikchat-input-area\">\n                    <textarea class=\"quikchat-input-textbox\"></textarea>\n                    <button class=\"quikchat-input-send-btn\">Send</button>\n                </div>\n            </div>\n            `;\n\n        this._parentElement.innerHTML = widgetHTML;\n        this._chatWidget = this._parentElement.querySelector('.quikchat-base');\n        this._titleArea = this._chatWidget.querySelector('.quikchat-title-area');\n        this._messagesArea = this._chatWidget.querySelector('.quikchat-messages-area');\n        this._inputArea = this._chatWidget.querySelector('.quikchat-input-area');\n        this._textEntry = this._inputArea.querySelector('.quikchat-input-textbox');\n        this._sendButton = this._inputArea.querySelector('.quikchat-input-send-btn');\n        this.msgid = 0;\n    }\n\n    /**\n     * Attach event listeners to the widget\n     */\n    _attachEventListeners() {\n        this._sendButton.addEventListener('click', (event) => { event.preventDefault(); this._onSend(this, this._textEntry.value.trim()) });\n        window.addEventListener('resize', () => this._handleContainerResize());\n        this._chatWidget.addEventListener('resize', () => this._handleContainerResize());\n        this._textEntry.addEventListener('keydown', (event) => {\n\n            // Check if Shift + Enter is pressed then we just do carraige\n            if (event.shiftKey && event.keyCode === 13) {\n                // Prevent default behavior (adding new line)\n                if (this.sendOnShiftEnter) {\n                    event.preventDefault();\n                    this._onSend(this, this._textEntry.value.trim());\n                }\n            } else if (event.keyCode === 13) {// Enter but not Shift + Enter\n                if (this.sendOnEnter) {\n                    event.preventDefault();\n                    this._onSend(this, this._textEntry.value.trim());\n                }\n            }\n        });\n\n        this._messagesArea.addEventListener('scroll', () => {\n            const { scrollTop, scrollHeight, clientHeight } = this._messagesArea;\n            this.userScrolledUp = scrollTop + clientHeight < scrollHeight;\n        });\n    }\n\n    // set the onSend function callback.\n    setCallbackOnSend(callback) {\n        this._onSend = callback;\n    }\n    // set a callback for everytime a message is added (listener)\n    setCallbackonMessageAdded(callback) {\n        this._onMessageAdded = callback;\n    }\n\n    // Public methods\n    titleAreaToggle() {\n        this._titleArea.style.display === 'none' ? this.titleAreaShow() : this.titleAreaHide();\n    }\n\n    titleAreaShow() {\n        this._titleArea.style.display = '';\n        this._adjustMessagesAreaHeight();\n    }\n\n    titleAreaHide() {\n        this._titleArea.style.display = 'none';\n        this._adjustMessagesAreaHeight();\n    }\n\n    titleAreaSetContents(title, align = 'center') {\n        this._titleArea.innerHTML = title;\n        this._titleArea.style.textAlign = align;\n    }\n\n    titleAreaGetContents() {\n        return this._titleArea.innerHTML;\n    }\n\n    inputAreaToggle() {\n        this._inputArea.classList.toggle('hidden');\n        this._inputArea.style.display === 'none' ? this.inputAreaShow() : this.inputAreaHide();\n    }\n\n    inputAreaShow() {\n        this._inputArea.style.display = '';\n        this._adjustMessagesAreaHeight();\n    }\n\n    inputAreaHide() {\n        this._inputArea.style.display = 'none';\n        this._adjustMessagesAreaHeight();\n    }\n\n    _adjustMessagesAreaHeight() {\n        const hiddenElements = [...this._chatWidget.children].filter(child => child.classList.contains('hidden'));\n        const totalHiddenHeight = hiddenElements.reduce((sum, child) => sum + child.offsetHeight, 0);\n        const containerHeight = this._chatWidget.offsetHeight;\n        this._messagesArea.style.height = `calc(100% - ${containerHeight - totalHiddenHeight}px)`;\n    }\n\n    _handleContainerResize() {\n        this._adjustMessagesAreaHeight();\n        this._adjustSendButtonWidth();\n        return true;\n    }\n\n    _adjustSendButtonWidth() {\n        const sendButtonText = this._sendButton.textContent.trim();\n        const fontSize = parseFloat(getComputedStyle(this._sendButton).fontSize);\n        const minWidth = fontSize * sendButtonText.length + 16;\n        this._sendButton.style.minWidth = `${minWidth}px`;\n        return true;\n    }\n\n    //messagesArea functions\n    messagesAreaAlternateColors(alt = true) {\n        if (alt) {\n            this._messagesArea.classList.add('quikchat-messages-area-alt');\n        }\n        else {\n            this._messagesArea.classList.remove('quikchat-messages-area-alt');\n        }\n        return alt === true;\n    }\n    messagesAreaAlternateColorsToggle() {\n        this._messagesArea.classList.toggle('quikchat-messages-area-alt');\n    }\n    messagesAreaAlternateColorsGet() {\n        return this._messagesArea.classList.contains('quikchat-messages-area-alt');\n    }\n    // message functions\n    messageAddFull(input = { content: \"\", userString: \"user\", align: \"right\", role: \"user\", userID: -1, timestamp: false, updatedtime: false, scrollIntoView: true, visible: true, tags: [] }) {\n        const msgid = this.msgid;\n        const messageDiv = document.createElement('div');\n        const msgidClass = 'quikchat-msgid-' + String(msgid).padStart(10, '0');\n        const userIdClass = 'quikchat-userid-' + String(input.userString).padStart(10, '0'); // hash this..\n        messageDiv.classList.add('quikchat-message', msgidClass, 'quikchat-structure');\n\n        if (Array.isArray(input.tags)) {\n            input.tags.forEach(tag => {\n                if (typeof tag === 'string' && /^[a-zA-Z0-9-]+$/.test(tag)) {\n                    messageDiv.classList.add(`quikchat-tag-${tag}`);\n                    this._activeTags.add(tag);\n                }\n            });\n        }\n\n        this.msgid++;\n\n        const userDiv = document.createElement('div');\n        userDiv.innerHTML = input.userString;\n        userDiv.classList.add('quikchat-user-label');\n        userDiv.style.textAlign = input.align;\n    \n        const contentDiv = document.createElement('div');\n        contentDiv.classList.add('quikchat-message-content');\n    \n        // Determine text alignment for right-aligned messages\n        if (input.align === \"right\") {\n            const isMultiLine = input.content.includes(\"\\n\");\n            const isLong = input.content.length > 50; // Adjust length threshold\n    \n            if (isMultiLine || isLong) {\n                contentDiv.classList.add(\"quikchat-right-multiline\");\n            } else {\n                contentDiv.classList.add(\"quikchat-right-singleline\");\n            }\n        }\n    \n        contentDiv.innerHTML = input.content;\n    \n        messageDiv.appendChild(userDiv);\n        messageDiv.appendChild(contentDiv);\n        this._messagesArea.appendChild(messageDiv);\n        \n        const visible = input.visible === undefined ? true : input.visible;\n        if (!visible) {\n            messageDiv.style.display = 'none';\n        }\n    \n        // Scroll to the last message only if the user is not actively scrolling up\n        if ((!this.userScrolledUp) || input.scrollIntoView) {\n            this.messageScrollToBottom();\n        }\n    \n        this._textEntry.value = '';\n        this._adjustMessagesAreaHeight();\n        this._handleShortLongMessageCSS(messageDiv, input.align); // Handle CSS for short/long messages\n        this._updateMessageStyles();\n    \n        // Add timestamp now, unless it is passed in \n        const timestamp = input.timestamp ? input.timestamp : new Date().toISOString();\n        const updatedtime = input.updatedtime ? input.updatedtime : timestamp;\n    \n        if (this.trackHistory) {\n            this._history.push({ msgid, ...input, visible, timestamp, updatedtime, messageDiv });\n            if (this._history.length > this._historyLimit) {\n                this._history.shift();\n            }\n        }\n    \n        if (this._onMessageAdded) {\n            this._onMessageAdded(this, msgid);\n        }\n    \n        return msgid;\n    }\n    \n\n\n    messageAddNew(content = \"\", userString = \"user\", align = \"right\", role = \"user\", scrollIntoView = true, visible = true, tags = []) {\n        let retvalue = this.messageAddFull(\n            { content: content, userString: userString, align: align, role: role, scrollIntoView: scrollIntoView, visible: visible, tags: tags }\n        );\n        // this.messageScrollToBottom();\n        return retvalue;\n    }\n\n    messageRemove(n) {\n        // use css selector to remove the message\n        let sucess = false;\n        try {\n            this._messagesArea.removeChild(this._messagesArea.querySelector(`.quikchat-msgid-${String(n).padStart(10, '0')}`));\n            sucess = true;\n        }\n        catch (error) {\n            console.log(`{String(n)} : Message ID not found`);\n        }\n        if (sucess) {\n            // slow way to remove from history\n            //this._history = this._history.filter((item) => item.msgid !== n); // todo make this more efficient\n\n            // better way to delete this from history\n            this._history.splice(this._history.findIndex((item) => item.msgid === n), 1);\n        }\n        return sucess;\n    }\n    /* returns the message html object from the DOM\n    */\n    messageGetDOMObject(n) {\n        let msg = null;\n        // now use css selector to get the message \n        try {\n            msg = this._messagesArea.querySelector(`.quikchat-msgid-${String(n).padStart(10, '0')}`);\n        }\n        catch (error) {\n            console.log(`{String(n)} : Message ID not found`);\n        }\n        return msg;\n    }\n    /* returns the message content only\n    */\n    messageGetContent(n) {\n        let content = \"\"\n        // now use css selector to get the message \n        try {\n            // get from history..\n            content = this._history.filter((item) => item.msgid === n)[0].content;\n            //content =  this._messagesArea.querySelector(`.quikchat-msgid-${String(n).padStart(10, '0')}`).lastChild.textContent;\n        }\n        catch (error) {\n            console.log(`{String(n)} : Message ID not found`);\n        }\n        return content;\n    }\n\n    /* returns the DOM Content element of a given message\n    */\n    messageGetContentDOMElement(n) {\n        let contentElement = null;\n        // now use css selector to get the message\n        try {\n            //contentElement = this._messagesArea.querySelector(`.quikchat-msgid-${String(n).padStart(10, '0')}`).lastChild;\n            contentElement = this._history.filter((item) => item.msgid === n)[0].messageDiv.lastChild;\n        }\n        catch (error) {\n            console.log(`{String(n)} : Message ID not found`);\n        }\n        return contentElement;\n    }\n\n    /* append message to the message content\n    */\n\n    messageAppendContent(n, content) {\n        let success = false;\n        try {\n            this._messagesArea.querySelector(`.quikchat-msgid-${String(n).padStart(10, '0')}`).lastChild.innerHTML += content;\n            // update history\n            let item = this._history.filter((item) => item.msgid === n)[0];\n            item.content += content;\n            item.updatedtime = new Date().toISOString();\n            success = true;\n\n            // Scroll to the last message only if the user is not actively scrolling up\n            if (!this.userScrolledUp) {\n                this._messagesArea.lastElementChild.scrollIntoView();\n            }\n        } catch (error) {\n            console.log(`${String(n)} : Message ID not found`);\n        }\n        return success;\n    }\n\n    /* replace message content\n    */\n    messageReplaceContent(n, content) {\n        let success = false;\n        try {\n            this._messagesArea.querySelector(`.quikchat-msgid-${String(n).padStart(10, '0')}`).lastChild.innerHTML = content;\n            // update history\n            let item = this._history.filter((item) => item.msgid === n)[0];\n            item.content = content;\n            item.updatedtime = new Date().toISOString();\n            success = true;\n\n            // Scroll to the last message only if the user is not actively scrolling up\n            if (!this.userScrolledUp) {\n                this._messagesArea.lastElementChild.scrollIntoView();\n            }\n        } catch (error) {\n            console.log(`${String(n)} : Message ID not found`);\n        }\n        return success;\n    }\n\n    /**\n     * Scrolls the messages area to the bottom.\n     */\n    messageScrollToBottom() {\n        if (this._messagesArea.lastElementChild) {\n            this._messagesArea.lastElementChild.scrollIntoView();\n        }\n    }\n\n    /**\n     * Removes the last message from the messages area.\n     */\n    messageRemoveLast() {\n        // find the last message by id:\n        if (this._history.length >= 0) {\n            let lastMsgId = this._history[this._history.length - 1].msgid;\n            return this.messageRemove(lastMsgId);\n        }\n        return false;\n    }\n\n    messageSetVisibility(msgid, isVisible) {\n        const message = this._history.find(item => item.msgid === msgid);\n        if (message && message.messageDiv) {\n            message.messageDiv.style.display = isVisible ? '' : 'none';\n            message.visible = isVisible;\n            this._updateMessageStyles();\n            return true;\n        }\n        return false;\n    }\n\n    messageGetVisibility(msgid) {\n        const message = this._history.find(item => item.msgid === msgid);\n        if (message && message.messageDiv) {\n            return message.messageDiv.style.display !== 'none';\n        }\n        return false; // Return false if not found or no messageDiv\n    }\n\n    _updateMessageStyles() {\n        const visibleMessages = [...this._messagesArea.children].filter(\n            child => child.style.display !== 'none'\n        );\n\n        visibleMessages.forEach((messageDiv, index) => {\n            messageDiv.classList.remove('quikchat-message-1', 'quikchat-message-2');\n            messageDiv.classList.add(index % 2 === 0 ? 'quikchat-message-1' : 'quikchat-message-2');\n        });\n    }\n\n    /**\n     * For right sided or centered messages, we need to handle the CSS for short and long messages.\n     * for short messages we use simple justifying, for long messages we need to wrap and perform multiline\n     * formatting. \n     * \n     * @param {*} messageElement \n     * @returns nothing\n     */\n    _handleShortLongMessageCSS(messageElement, align) {\n        // console.log(messageElement);\n        // Reset classes\n        messageElement.classList.remove(\n            'left-singleline', 'left-multiline',\n            'center-singleline', 'center-multiline',\n            'right-singleline', 'right-multiline');\n        let contentDiv = messageElement.lastChild;\n        window.lastDiv = contentDiv; // for debugging   \n        // Determine if the message is short or long\n\n        const computedStyle = window.getComputedStyle(contentDiv);\n\n        // Get the element's height\n        const elementHeight = contentDiv.offsetHeight;\n\n        // Calculate or estimate line height\n        let lineHeight;\n        if (computedStyle.lineHeight === \"normal\") {\n            const fontSize = parseFloat(computedStyle.fontSize);\n            lineHeight = fontSize * 1.2; // approximate \"normal\" as 1.2 times font-size\n        } else {\n            lineHeight = parseFloat(computedStyle.lineHeight);\n        }\n\n        // Check if the element height is more than one line-height\n        const isMultiLine = elementHeight > lineHeight;\n\n        // Using scrollHeight and clientHeight to check for overflow (multi-line)\n        switch (align) {\n            case 'center':\n                if (isMultiLine) {\n                    messageElement.classList.add('center-multiline');\n                }\n                else {\n                    messageElement.classList.add('center-singleline');\n                }\n                break;\n            case 'right':\n                if (isMultiLine) {\n                    messageElement.classList.add('right-multiline');\n                }\n                else {\n                    messageElement.classList.add('right-singleline');\n                }\n                break;\n            case 'left':\n            default:\n                if (isMultiLine) {\n                    messageElement.classList.add('left-multiline');\n                }\n                else {\n                    messageElement.classList.add('left-singleline');\n                }\n                break;\n        }\n\n    }\n    // history functions\n    /**\n     * \n     * @param {*} n \n     * @param {*} m \n     * @returns array of history messages\n     */\n    historyGet(n, m) {\n\n        if (n == undefined) {\n            n = 0;\n            m = this._history.length;\n        }\n        if (m === undefined) {\n            m = n < 0 ? m : n + 1;\n        }\n        // remember that entries could be deleted.  TODO: So we need to return the actual history entries\n        // so now we need to find the array index that correspondes to messageIds n (start) and m (end)\n\n        return this._history.slice(n, m);\n    }\n\n    historyGetAllCopy() {\n        return this._history.slice();\n    }\n\n    historyClear() {\n        this.msgid = 0;\n        this._messagesArea.innerHTML = \"\";\n        this._history = [];\n        this._activeTags.clear();\n    }\n\n    historyGetLength() {\n        return this._history.length;\n    }\n\n    historyGetMessage(n) {\n        if (n >= 0 && n < this._history.length) {\n            return this._history[n];\n        }\n        return {};\n\n    }\n\n    historyGetMessageContent(n) {\n        if (n >= 0 && n < this._history.length)\n            return this._history[n].content;\n        else\n            return \"\";\n    }\n\n    // expects an array of messages to be in the format of the history object\n    historyRestoreAll(messageList) {\n        // clear all messages and history\n        this.historyClear();\n\n        // clear the messages div \n        this._messagesArea.innerHTML = \"\";\n\n        // add all messages\n        messageList.forEach((message) => {\n            this.messageAddFull(message);\n        });\n    }\n    /**\n     * \n     * @param {string} newTheme \n     */\n    changeTheme(newTheme) {\n        this._chatWidget.classList.remove(this._theme);\n        this._chatWidget.classList.add(newTheme);\n        this._theme = newTheme;\n    }\n\n    /**\n     *  Get the current theme\n     * @returns {string} - The current theme\n     */\n    get theme() {\n        return this._theme;\n    }\n\n    /**\n     * \n     * @returns {object} - Returns the version and license information for the library.\n     */\n    static version() {\n        return { \"version\": \"1.1.14\", \"license\": \"BSD-2\", \"url\": \"https://github/deftio/quikchat\", \"fun\": true };\n    }\n\n    /**\n     * quikchat.loremIpsum() - Generate a simple string of Lorem Ipsum text (sample typographer's text) of numChars in length.\n     * borrowed from github.com/deftio/bitwrench.js\n     * @param {number} numChars - The number of characters to generate (random btw 25 and 150 if undefined).    \n     * @param {number} [startSpot=0] - The starting index in the Lorem Ipsum text. If undefined, a random startSpot will be generated.\n     * @param {boolean} [startWithCapitalLetter=true] - If true, capitalize the first character or inject a capital letter if the first character isn't a capital letter.\n     * \n     * @returns {string} A string of Lorem Ipsum text.\n     * \n     * @example \n     * // Returns 200 characters of Lorem Ipsum starting from index 50\n     * loremIpsum(200, 50);\n     * \n     * @example \n     * //Returns a 200 Lorem Ipsum characters starting from a random index\n     * loremIpsum(200);\n     */\n\n    static loremIpsum(numChars, startSpot = undefined, startWithCapitalLetter = true) {\n        const loremText = \"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. \";\n\n        if (typeof numChars !== \"number\") {\n            numChars = Math.floor(Math.random() * (150)) + 25;\n        }\n\n        if (startSpot === undefined) {\n            startSpot = Math.floor(Math.random() * loremText.length);\n        }\n\n        startSpot = startSpot % loremText.length;\n\n        // Move startSpot to the next non-whitespace and non-punctuation character\n        while (loremText[startSpot] === ' ' || /[.,:;!?]/.test(loremText[startSpot])) {\n            startSpot = (startSpot + 1) % loremText.length;\n        }\n\n        let l = loremText.substring(startSpot) + loremText.substring(0, startSpot);\n\n        if (typeof numChars !== \"number\") {\n            numChars = l.length;\n        }\n\n        let s = \"\";\n        while (numChars > 0) {\n            s += numChars < l.length ? l.substring(0, numChars) : l;\n            numChars -= l.length;\n        }\n\n        if (s[s.length - 1] === \" \") {\n            s = s.substring(0, s.length - 1) + \".\"; // always end on non-whitespace. \".\" was chosen arbitrarily.\n        }\n\n        if (startWithCapitalLetter) {\n            let c = s[0].toUpperCase();\n            c = /[A-Z]/.test(c) ? c : \"M\";\n            s = c + s.substring(1);\n        }\n\n        return s;\n    };\n\n    static tempMessageGenerator (domElement, content, interval, cb = null) {\n        interval = Math.max(interval, 100); // Ensure at least 100ms interval\n    \n        let count = 0;\n\n        let defaultCB = (msg, count) => {msg += \".\"; return msg; };\n\n        if (cb && typeof cb !== 'function') {\n            cb = null;\n        }\n\n        cb = cb || defaultCB;\n        \n        // if its a string, then get the element (css sel) or its an DOM element already \n        let el  = domElement;\n        if (typeof el === 'string') {\n            el = document.querySelector(el);\n        } \n\n        const element = el;\n\n    \n        // Ensure the element exists\n        if (!element) return;\n    \n        element.innerHTML = content;\n        let currentMsg = content;\n    \n        const intervalId = setInterval(() => {\n            if (element.innerHTML !== currentMsg) {\n                clearInterval(intervalId); // Stop updating if content is changed externally\n                return;\n            }\n            \n            currentMsg = String( cb(currentMsg, count)) ;// Use callback return value if provided\n            \n            count++;\n            element.innerHTML = currentMsg;\n        }, interval);\n    }\n\n    static createTempMessageDOMStr(initialContent, updateInterval = 1000, callback = null, options = {}) {\n        // Make sure the interval is at least 100ms\n        updateInterval = Math.max(updateInterval, 100);\n        \n        // Validate callback; if not a function, ignore it.\n        if (callback && typeof callback !== 'function') {\n          callback = null;\n        }\n        // Default callback simply appends a dot.\n        callback = callback || function(msg, count) {\n          return msg + \".\";\n        };\n      \n        // Allow an optional CSS class for the container element\n        const containerClass = options.containerClass ? options.containerClass : '';\n      \n        // Generate a unique id so that the inline script can reliably find the container.\n        const uniqueId = \"tempMsg_\" + Date.now() + \"_\" + Math.floor(Math.random() * 1000000);\n      \n        // Build and return the HTML string.\n        // Note the use of <\\/script> (with a backslash) so that the inline script is not terminated early.\n        return `\n          <span id=\"${uniqueId}\" ${containerClass ? `class=\"${containerClass}\"` : ''}>\n            ${initialContent}\n          </span>\n          <script>\n            (function(){\n              // Get our container element by its unique id.\n              var container = document.getElementById(\"${uniqueId}\");\n              if (!container) return;\n              var count = 0;\n              var currentMsg = container.innerHTML;\n              var interval = ${updateInterval};\n              // Convert the callback function into its string representation.\n              var cb = ${callback.toString()};\n              var intervalId = setInterval(function(){\n                // If the content has been replaced, stop updating.\n                if(container.innerHTML !== currentMsg){\n                  clearInterval(intervalId);\n                  return;\n                }\n                // Use the callback to generate the new message.\n                currentMsg = String(cb(currentMsg, count));\n                count++;\n                container.innerHTML = currentMsg;\n              }, interval);\n            })();\n          <\\/script>\n        `;\n      }\n      \n    setTagVisibility(tagName, isVisible) {\n        if (typeof tagName !== 'string' || !/^[a-zA-Z0-9-]+$/.test(tagName)) {\n            return false;\n        }\n        const className = `quikchat-show-tag-${tagName}`;\n        if (isVisible) {\n            this._chatWidget.classList.add(className);\n        } else {\n            this._chatWidget.classList.remove(className);\n        }\n        this._updateMessageStyles();\n        return true;\n    }\n\n    getTagVisibility(tagName) {\n        if (typeof tagName !== 'string' || !/^[a-zA-Z0-9-]+$/.test(tagName)) {\n            return false;\n        }\n        return this._chatWidget.classList.contains(`quikchat-show-tag-${tagName}`);\n    }\n\n    getActiveTags() {\n        return Array.from(this._activeTags);\n    }\n}\n\nexport default quikchat;\n"],"names":["quikchat","parentElement","onSend","arguments","length","undefined","options","_classCallCheck","meta","_objectSpread","defaultOpts","theme","trackHistory","titleArea","title","show","align","messagesArea","alternating","inputArea","sendOnEnter","sendOnShiftEnter","instanceClass","document","querySelector","this","_parentElement","_theme","_onSend","_createWidget","_chatWidget","classList","add","titleAreaSetContents","titleAreaShow","titleAreaHide","messagesAreaAlternateColors","inputAreaShow","inputAreaHide","_attachEventListeners","_historyLimit","_history","_activeTags","Set","key","value","widgetHTML","concat","innerHTML","_titleArea","_messagesArea","_inputArea","_textEntry","_sendButton","msgid","_this","addEventListener","event","preventDefault","trim","window","_handleContainerResize","shiftKey","keyCode","_this$_messagesArea","scrollTop","scrollHeight","clientHeight","userScrolledUp","callback","_onMessageAdded","style","display","_adjustMessagesAreaHeight","textAlign","toggle","totalHiddenHeight","_toConsumableArray","children","filter","child","contains","reduce","sum","offsetHeight","containerHeight","height","_adjustSendButtonWidth","sendButtonText","textContent","minWidth","parseFloat","getComputedStyle","fontSize","alt","remove","_this2","input","content","userString","role","userID","timestamp","updatedtime","scrollIntoView","visible","tags","messageDiv","createElement","msgidClass","String","padStart","Array","isArray","forEach","tag","test","userDiv","contentDiv","isMultiLine","includes","isLong","appendChild","messageScrollToBottom","_handleShortLongMessageCSS","_updateMessageStyles","Date","toISOString","push","shift","messageAddFull","n","sucess","removeChild","error","console","log","splice","findIndex","item","msg","contentElement","lastChild","success","lastElementChild","lastMsgId","messageRemove","isVisible","message","find","index","messageElement","lastDiv","lineHeight","computedStyle","elementHeight","m","slice","clear","messageList","_this3","historyClear","newTheme","get","tagName","className","from","version","license","url","fun","numChars","startSpot","startWithCapitalLetter","loremText","Math","floor","random","l","substring","s","c","toUpperCase","domElement","interval","cb","max","count","el","element","currentMsg","intervalId","setInterval","clearInterval","initialContent","updateInterval","containerClass","uniqueId","now","toString"],"mappings":"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"}