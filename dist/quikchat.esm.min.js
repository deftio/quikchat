function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=Array(t);i<t;i++)n[i]=e[i];return n}function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,r(n.key),n)}}function i(e,t,i){return(t=r(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function s(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?n(Object(s),!0).forEach((function(t){i(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function a(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(t,i){if(t){if("string"==typeof t)return e(t,i);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,i):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}var o={version:"1.1.15",license:"BSD-2",url:"https://github/deftio/quikchat",fun:!0},l=function(){return e=function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var a=s(s({},{theme:"quikchat-theme-light",trackHistory:!0,titleArea:{title:"Chat",show:!1,align:"center"},messagesArea:{alternating:!0},inputArea:{show:!0},sendOnEnter:!0,sendOnShiftEnter:!1,instanceClass:""}),n);"string"==typeof t&&(t=document.querySelector(t)),this._parentElement=t,this._theme=a.theme,this._onSend=i||function(){},this._createWidget(),a.instanceClass&&this._chatWidget.classList.add(a.instanceClass),a.titleArea&&(this.titleAreaSetContents(a.titleArea.title,a.titleArea.align),!0===a.titleArea.show?this.titleAreaShow():this.titleAreaHide()),a.messagesArea&&this.messagesAreaAlternateColors(a.messagesArea.alternating),a.inputArea&&(!0===a.inputArea.show?this.inputAreaShow():this.inputAreaHide()),this._attachEventListeners(),this.trackHistory=a.trackHistory||!0,this._historyLimit=1e7,this._history=[],this._activeTags=new Set,this.sendOnEnter=a.sendOnEnter,this.sendOnShiftEnter=a.sendOnShiftEnter},i=[{key:"_createWidget",value:function(){var e='\n            <div class="quikchat-base '.concat(this.theme,'">\n                <div class="quikchat-title-area">\n                    <span style="font-size: 1.5em; font-weight: 600;">Title Area</span>\n                </div>\n                <div class="quikchat-messages-area"></div>\n                <div class="quikchat-input-area">\n                    <textarea class="quikchat-input-textbox"></textarea>\n                    <button class="quikchat-input-send-btn">Send</button>\n                </div>\n            </div>\n            ');this._parentElement.innerHTML=e,this._chatWidget=this._parentElement.querySelector(".quikchat-base"),this._titleArea=this._chatWidget.querySelector(".quikchat-title-area"),this._messagesArea=this._chatWidget.querySelector(".quikchat-messages-area"),this._inputArea=this._chatWidget.querySelector(".quikchat-input-area"),this._textEntry=this._inputArea.querySelector(".quikchat-input-textbox"),this._sendButton=this._inputArea.querySelector(".quikchat-input-send-btn"),this.msgid=0}},{key:"_attachEventListeners",value:function(){var e=this;this._sendButton.addEventListener("click",(function(t){t.preventDefault(),e._onSend(e,e._textEntry.value.trim())})),window.addEventListener("resize",(function(){return e._handleContainerResize()})),this._chatWidget.addEventListener("resize",(function(){return e._handleContainerResize()})),this._textEntry.addEventListener("keydown",(function(t){t.shiftKey&&13===t.keyCode?e.sendOnShiftEnter&&(t.preventDefault(),e._onSend(e,e._textEntry.value.trim())):13===t.keyCode&&e.sendOnEnter&&(t.preventDefault(),e._onSend(e,e._textEntry.value.trim()))})),this._messagesArea.addEventListener("scroll",(function(){var t=e._messagesArea,i=t.scrollTop,n=t.scrollHeight,s=t.clientHeight;e.userScrolledUp=i+s<n}))}},{key:"setCallbackOnSend",value:function(e){this._onSend=e}},{key:"setCallbackonMessageAdded",value:function(e){this._onMessageAdded=e}},{key:"setCallbackonMessageAppend",value:function(e){this._onMessageAppend=e}},{key:"setCallbackonMessageReplace",value:function(e){this._onMessageReplace=e}},{key:"setCallbackonMessageDelete",value:function(e){this._onMessageDelete=e}},{key:"titleAreaToggle",value:function(){"none"===this._titleArea.style.display?this.titleAreaShow():this.titleAreaHide()}},{key:"titleAreaShow",value:function(){this._titleArea.style.display="",this._adjustMessagesAreaHeight()}},{key:"titleAreaHide",value:function(){this._titleArea.style.display="none",this._adjustMessagesAreaHeight()}},{key:"titleAreaSetContents",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center";this._titleArea.innerHTML=e,this._titleArea.style.textAlign=t}},{key:"titleAreaGetContents",value:function(){return this._titleArea.innerHTML}},{key:"inputAreaToggle",value:function(){this._inputArea.classList.toggle("hidden"),"none"===this._inputArea.style.display?this.inputAreaShow():this.inputAreaHide()}},{key:"inputAreaShow",value:function(){this._inputArea.style.display="",this._adjustMessagesAreaHeight()}},{key:"inputAreaHide",value:function(){this._inputArea.style.display="none",this._adjustMessagesAreaHeight()}},{key:"_adjustMessagesAreaHeight",value:function(){var e=a(this._chatWidget.children).filter((function(e){return e.classList.contains("hidden")})).reduce((function(e,t){return e+t.offsetHeight}),0),t=this._chatWidget.offsetHeight;this._messagesArea.style.height="calc(100% - ".concat(t-e,"px)")}},{key:"_handleContainerResize",value:function(){return this._adjustMessagesAreaHeight(),this._adjustSendButtonWidth(),!0}},{key:"_adjustSendButtonWidth",value:function(){var e=this._sendButton.textContent.trim(),t=parseFloat(getComputedStyle(this._sendButton).fontSize)*e.length+16;return this._sendButton.style.minWidth="".concat(t,"px"),!0}},{key:"messagesAreaAlternateColors",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e?this._messagesArea.classList.add("quikchat-messages-area-alt"):this._messagesArea.classList.remove("quikchat-messages-area-alt"),!0===e}},{key:"messagesAreaAlternateColorsToggle",value:function(){this._messagesArea.classList.toggle("quikchat-messages-area-alt")}},{key:"messagesAreaAlternateColorsGet",value:function(){return this._messagesArea.classList.contains("quikchat-messages-area-alt")}},{key:"messageAddFull",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{content:"",userString:"user",align:"right",role:"user",userID:-1,timestamp:!1,updatedtime:!1,scrollIntoView:!0,visible:!0,tags:[]},i=this.msgid,n=document.createElement("div"),a="quikchat-msgid-"+String(i).padStart(10,"0");String(t.userString).padStart(10,"0"),n.classList.add("quikchat-message",a,"quikchat-structure"),Array.isArray(t.tags)&&t.tags.forEach((function(t){"string"==typeof t&&/^[a-zA-Z0-9-]+$/.test(t)&&(n.classList.add("quikchat-tag-".concat(t)),e._activeTags.add(t))})),this.msgid++;var r=document.createElement("div");r.innerHTML=t.userString,r.classList.add("quikchat-user-label"),r.style.textAlign=t.align;var o=document.createElement("div");if(o.classList.add("quikchat-message-content"),"right"===t.align){var l=t.content.includes("\n"),u=t.content.length>50;l||u?o.classList.add("quikchat-right-multiline"):o.classList.add("quikchat-right-singleline")}o.innerHTML=t.content,n.appendChild(r),n.appendChild(o),this._messagesArea.appendChild(n);var c=void 0===t.visible||t.visible;c||(n.style.display="none"),!0===t.scrollIntoView?this.messageScrollToBottom():"smart"!==t.scrollIntoView||this.userScrolledUp||this.messageScrollToBottom(),this._textEntry.value="",this._adjustMessagesAreaHeight(),this._handleShortLongMessageCSS(n,t.align),this._updateMessageStyles();var h=t.timestamp?t.timestamp:(new Date).toISOString(),g=t.updatedtime?t.updatedtime:h;return this.trackHistory&&(this._history.push(s(s({msgid:i},t),{},{visible:c,timestamp:h,updatedtime:g,messageDiv:n})),this._history.length>this._historyLimit&&this._history.shift()),this._onMessageAdded&&this._onMessageAdded(this,i),i}},{key:"messageAddNew",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"user",s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];return this.messageAddFull({content:e,userString:t,align:i,role:n,scrollIntoView:s,visible:a,tags:r})}},{key:"messageRemove",value:function(e){var t=!1;try{this._messagesArea.removeChild(this._messagesArea.querySelector(".quikchat-msgid-".concat(String(e).padStart(10,"0")))),t=!0}catch(e){console.log("{String(n)} : Message ID not found")}return t&&(this._history.splice(this._history.findIndex((function(t){return t.msgid===e})),1),this._onMessageDelete&&this._onMessageDelete(this,e)),t}},{key:"messageGetDOMObject",value:function(e){var t=null;try{t=this._messagesArea.querySelector(".quikchat-msgid-".concat(String(e).padStart(10,"0")))}catch(e){console.log("{String(n)} : Message ID not found")}return t}},{key:"messageGetContent",value:function(e){var t="";try{t=this._history.filter((function(t){return t.msgid===e}))[0].content}catch(e){console.log("{String(n)} : Message ID not found")}return t}},{key:"messageGetContentDOMElement",value:function(e){var t=null;try{t=this._history.filter((function(t){return t.msgid===e}))[0].messageDiv.lastChild}catch(e){console.log("{String(n)} : Message ID not found")}return t}},{key:"messageAppendContent",value:function(e,t){var i=!1;try{this._messagesArea.querySelector(".quikchat-msgid-".concat(String(e).padStart(10,"0"))).lastChild.innerHTML+=t;var n=this._history.filter((function(t){return t.msgid===e}))[0];n.content+=t,n.updatedtime=(new Date).toISOString(),i=!0,this._onMessageAppend&&this._onMessageAppend(this,e,t)}catch(t){console.log("".concat(String(e)," : Message ID not found"))}return i}},{key:"messageReplaceContent",value:function(e,t){var i=!1;try{this._messagesArea.querySelector(".quikchat-msgid-".concat(String(e).padStart(10,"0"))).lastChild.innerHTML=t;var n=this._history.filter((function(t){return t.msgid===e}))[0];n.content=t,n.updatedtime=(new Date).toISOString(),i=!0,this._onMessageReplace&&this._onMessageReplace(this,e,t)}catch(t){console.log("".concat(String(e)," : Message ID not found"))}return i}},{key:"messageScrollToBottom",value:function(){this._messagesArea.lastElementChild&&this._messagesArea.lastElementChild.scrollIntoView()}},{key:"messageRemoveLast",value:function(){if(this._history.length>=0){var e=this._history[this._history.length-1].msgid;return this.messageRemove(e)}return!1}},{key:"messageSetVisibility",value:function(e,t){var i=this._history.find((function(t){return t.msgid===e}));return!(!i||!i.messageDiv||(i.messageDiv.style.display=t?"":"none",i.visible=t,this._updateMessageStyles(),0))}},{key:"messageGetVisibility",value:function(e){var t=this._history.find((function(t){return t.msgid===e}));return!(!t||!t.messageDiv)&&"none"!==t.messageDiv.style.display}},{key:"_updateMessageStyles",value:function(){a(this._messagesArea.children).filter((function(e){return"none"!==e.style.display})).forEach((function(e,t){e.classList.remove("quikchat-message-1","quikchat-message-2"),e.classList.add(t%2==0?"quikchat-message-1":"quikchat-message-2")}))}},{key:"_handleShortLongMessageCSS",value:function(e,t){e.classList.remove("left-singleline","left-multiline","center-singleline","center-multiline","right-singleline","right-multiline");var i=e.lastChild;window.lastDiv=i;var n,s=window.getComputedStyle(i),a=i.offsetHeight;n="normal"===s.lineHeight?1.2*parseFloat(s.fontSize):parseFloat(s.lineHeight);var r=a>n;switch(t){case"center":r?e.classList.add("center-multiline"):e.classList.add("center-singleline");break;case"right":r?e.classList.add("right-multiline"):e.classList.add("right-singleline");break;default:r?e.classList.add("left-multiline"):e.classList.add("left-singleline")}}},{key:"historyGet",value:function(e,t){return null==e&&(e=0,t=this._history.length),void 0===t&&(t=e<0?t:e+1),this._history.slice(e,t)}},{key:"historyGetAllCopy",value:function(){return this._history.slice()}},{key:"historyGetPage",value:function(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc",a=this._history.length,r=Math.ceil(a/n),o=Math.max(1,Math.min(i,r||1));"desc"===s?(e=Math.max(0,a-o*n),t=a-(o-1)*n):(e=(o-1)*n,t=Math.min(e+n,a));var l=this._history.slice(e,t);return"desc"===s&&l.reverse(),{messages:l,pagination:{currentPage:o,pageSize:n,totalPages:r,totalMessages:a,hasNext:o<r,hasPrevious:o>1,order:s}}}},{key:"historySearch",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._history;if(e.text){var i=e.text.toLowerCase();t=t.filter((function(e){return e.content.toLowerCase().includes(i)}))}e.userString&&(t=t.filter((function(t){return t.userString===e.userString}))),e.role&&(t=t.filter((function(t){return t.role===e.role}))),e.tags&&e.tags.length>0&&(t=t.filter((function(t){return t.tags&&t.tags.some((function(t){return e.tags.includes(t)}))})));var n=e.limit||100;return t.length>n&&(t=t.slice(0,n)),t}},{key:"historyGetInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=this._history.length;return{totalMessages:t,totalPages:Math.ceil(t/e),oldestMessage:t>0?{msgid:this._history[0].msgid,timestamp:this._history[0].timestamp,userString:this._history[0].userString}:null,newestMessage:t>0?{msgid:this._history[t-1].msgid,timestamp:this._history[t-1].timestamp,userString:this._history[t-1].userString}:null,memoryUsage:{estimatedSize:JSON.stringify(this._history).length,averageMessageSize:t>0?Math.round(JSON.stringify(this._history).length/t):0}}}},{key:"historyClear",value:function(){this.msgid=0,this._messagesArea.innerHTML="",this._history=[],this._activeTags.clear()}},{key:"historyGetLength",value:function(){return this._history.length}},{key:"historyGetMessage",value:function(e){return e>=0&&e<this._history.length?this._history[e]:{}}},{key:"historyGetMessageContent",value:function(e){return e>=0&&e<this._history.length?this._history[e].content:""}},{key:"historyRestoreAll",value:function(e){var t=this;this.historyClear(),this._messagesArea.innerHTML="",e.forEach((function(e){t.messageAddFull(e)}))}},{key:"changeTheme",value:function(e){this._chatWidget.classList.remove(this._theme),this._chatWidget.classList.add(e),this._theme=e}},{key:"theme",get:function(){return this._theme}},{key:"setTagVisibility",value:function(e,t){if("string"!=typeof e||!/^[a-zA-Z0-9-]+$/.test(e))return!1;var i="quikchat-show-tag-".concat(e);return t?this._chatWidget.classList.add(i):this._chatWidget.classList.remove(i),this._updateMessageStyles(),!0}},{key:"getTagVisibility",value:function(e){return!("string"!=typeof e||!/^[a-zA-Z0-9-]+$/.test(e))&&this._chatWidget.classList.contains("quikchat-show-tag-".concat(e))}},{key:"getActiveTags",value:function(){return Array.from(this._activeTags)}}],n=[{key:"version",value:function(){return o}},{key:"loremIpsum",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n="Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. ";for("number"!=typeof e&&(e=Math.floor(150*Math.random())+25),void 0===t&&(t=Math.floor(446*Math.random())),t%=446;" "===n[t]||/[.,:;!?]/.test(n[t]);)t=(t+1)%446;var s=n.substring(t)+n.substring(0,t);"number"!=typeof e&&(e=s.length);for(var a="";e>0;)a+=e<s.length?s.substring(0,e):s,e-=s.length;if(" "===a[a.length-1]&&(a=a.substring(0,a.length-1)+"."),i){var r=a[0].toUpperCase();a=(r=/[A-Z]/.test(r)?r:"M")+a.substring(1)}return a}},{key:"tempMessageGenerator",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i=Math.max(i,100);var s=0;n&&"function"!=typeof n&&(n=null),n=n||function(e,t){return e+="."};var a=e;"string"==typeof a&&(a=document.querySelector(a));var r=a;if(r){r.innerHTML=t;var o=t,l=setInterval((function(){r.innerHTML===o?(o=String(n(o,s)),s++,r.innerHTML=o):clearInterval(l)}),i)}}},{key:"createTempMessageDOMStr",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t=Math.max(t,100),i&&"function"!=typeof i&&(i=null),i=i||function(e,t){return e+"."};var s=n.containerClass?n.containerClass:"",a="tempMsg_"+Date.now()+"_"+Math.floor(1e6*Math.random());return'\n          <span id="'.concat(a,'" ').concat(s?'class="'.concat(s,'"'):"",">\n            ").concat(e,'\n          </span>\n          <script>\n            (function(){\n              // Get our container element by its unique id.\n              var container = document.getElementById("').concat(a,'");\n              if (!container) return;\n              var count = 0;\n              var currentMsg = container.innerHTML;\n              var interval = ').concat(t,";\n              // Convert the callback function into its string representation.\n              var cb = ").concat(i.toString(),";\n              var intervalId = setInterval(function(){\n                // If the content has been replaced, stop updating.\n                if(container.innerHTML !== currentMsg){\n                  clearInterval(intervalId);\n                  return;\n                }\n                // Use the callback to generate the new message.\n                currentMsg = String(cb(currentMsg, count));\n                count++;\n                container.innerHTML = currentMsg;\n              }, interval);\n            })();\n          <\/script>\n        ")}}],i&&t(e.prototype,i),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,i,n}();export{l as default};
//# sourceMappingURL=quikchat.esm.min.js.map
