"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=Array(e);i<e;i++)s[i]=t[i];return s}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,o(s.key),s)}}function s(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(t,e,i){return(e=o(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function r(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?r(Object(i),!0).forEach((function(e){n(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function l(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(e,i){if(e){if("string"==typeof e)return t(e,i);var s={}.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?t(e,i):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e);if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}var h={version:"1.1.16",license:"BSD-2",url:"https://github/deftio/quikchat",fun:!0},c=function(){return s((function t(i){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,t),this.container=i,this.items=[],this.itemHeight=s.itemHeight||80,this.buffer=s.buffer||5,this.visibleRange={start:0,end:0},this.renderedElements=new Map,this.itemHeights=new Map,this.itemPositions=new Map,this.totalHeight=0,this.onRenderItem=s.onRenderItem||function(){},this._initStructure(),this._attachScrollListener()}),[{key:"_initStructure",value:function(){var t=this,e=this.container.className;this.container.innerHTML="",this.container.className=e,this.container.style.position="relative",this.container.style.overflow="auto",this.container.style.height||0!==this.container.offsetHeight||(this.container.style.height="100%"),this.spacer=document.createElement("div"),this.spacer.style.cssText="position: absolute; top: 0; left: 0; width: 1px; pointer-events: none; z-index: -1;",this.content=document.createElement("div"),this.content.style.cssText="position: relative; width: 100%;",this.container.appendChild(this.spacer),this.container.appendChild(this.content),setTimeout((function(){t._updateVisibleRange(),t._renderVisibleItems()}),0)}},{key:"_attachScrollListener",value:function(){var t=this,e=!1;this.container.addEventListener("scroll",(function(){e||(requestAnimationFrame((function(){t._updateVisibleRange(),t._renderVisibleItems(),e=!1})),e=!0)}))}},{key:"_getItemHeight",value:function(t){return this.itemHeights.get(t)||this.itemHeight}},{key:"_getItemPosition",value:function(t){if(this.itemPositions.has(t))return this.itemPositions.get(t);for(var e=0,i=0;i<t;i++)e+=this._getItemHeight(i);return this.itemPositions.set(t,e),e}},{key:"_recalculatePositions",value:function(t){for(var e=t>0?this._getItemPosition(t):0,i=t;i<this.items.length;i++){this.itemPositions.set(i,e),e+=this._getItemHeight(i);var s=this.renderedElements.get(i);s&&(s.style.top="".concat(this.itemPositions.get(i),"px"))}this.totalHeight=e,this.spacer.style.height="".concat(this.totalHeight,"px")}},{key:"_updateVisibleRange",value:function(){var t=this.container.scrollTop,e=this.container.clientHeight,i=0,s=this.items.length;if(this.itemPositions.size>0){for(var n=0;n<this.items.length;n++){if(this._getItemPosition(n)+this._getItemHeight(n)>t){i=Math.max(0,n-this.buffer);break}}for(var r=i;r<this.items.length;r++){if(this._getItemPosition(r)>t+e){s=Math.min(this.items.length,r+this.buffer);break}}}else i=Math.max(0,Math.floor(t/this.itemHeight)-this.buffer),s=Math.min(this.items.length,Math.ceil((t+e)/this.itemHeight)+this.buffer);this.visibleRange={start:i,end:s}}},{key:"_renderVisibleItems",value:function(){var t=this,e=this.visibleRange,i=e.start,s=e.end;this.renderedElements.forEach((function(e,n){(n<i||n>=s)&&(e.remove(),t.renderedElements.delete(n))}));for(var n=function(e){var i=t.items[e];if(!i||t.renderedElements.has(e))return 1;var s=t._createItemElement(i,e);s.style.position="absolute",s.style.top="".concat(t._getItemPosition(e),"px"),s.style.left="0",s.style.right="0",t.renderedElements.set(e,s),t.content.appendChild(s),requestAnimationFrame((function(){if(t.renderedElements.has(e)){var i=s.offsetHeight;i&&i!==t._getItemHeight(e)&&(t.itemHeights.set(e,i),t._recalculatePositions(e))}}))},r=i;r<s;r++)n(r);this.onRenderItem(this.content)}},{key:"_createItemElement",value:function(t,e){var i=document.createElement("div");i.className="quikchat-message quikchat-message-".concat(t.align||"left"," quikchat-msgid-").concat(String(t.msgid).padStart(10,"0")),i.setAttribute("data-index",e),i.setAttribute("data-msgid",t.msgid),t.tags&&t.tags.length>0&&t.tags.forEach((function(t){return i.classList.add("quikchat-tag-".concat(t))}));var s=document.createElement("div");s.className="quikchat-message-user",s.innerHTML=t.userString||"";var n=document.createElement("div");return n.className="quikchat-message-content",n.innerHTML=t.content||"",i.appendChild(s),i.appendChild(n),t.visible||(i.style.display="none"),i}},{key:"addItem",value:function(t){this.items.push(t);var e=this.items.length-1,i=e>0?this._getItemPosition(e-1)+this._getItemHeight(e-1):0;return this.itemPositions.set(e,i),this.totalHeight=i+this.itemHeight,this.spacer.style.height="".concat(this.totalHeight,"px"),e>=this.visibleRange.start&&e<this.visibleRange.end&&this._renderVisibleItems(),t.scrollIntoView&&(this.container.scrollTop=this.container.scrollHeight),e}},{key:"addItems",value:function(t){var e,i=this.items.length;(e=this.items).push.apply(e,l(t));for(var s=i>0?this._getItemPosition(i-1)+this._getItemHeight(i-1):0,n=i;n<this.items.length;n++)this.itemPositions.set(n,s),s+=this.itemHeight;this.totalHeight=s,this.spacer.style.height="".concat(this.totalHeight,"px"),this._updateVisibleRange(),this._renderVisibleItems(),t.length>0&&t[t.length-1].scrollIntoView&&(this.container.scrollTop=this.container.scrollHeight)}},{key:"clear",value:function(){this.items=[],this.renderedElements.clear(),this.itemHeights.clear(),this.itemPositions.clear(),this.totalHeight=0,this.content.innerHTML="",this.spacer.style.height="0px",this.visibleRange={start:0,end:0},this._updateVisibleRange(),this._renderVisibleItems()}},{key:"updateItem",value:function(t,e){t>=0&&t<this.items.length&&(this.items[t]=a(a({},this.items[t]),e),this.renderedElements.has(t)&&this._renderVisibleItems())}},{key:"destroy",value:function(){this.container.innerHTML="",this.items=[],this.renderedElements.clear()}}])}(),u=function(){return s((function t(i){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e(this,t);var r=a(a({},{theme:"quikchat-theme-light",trackHistory:!0,titleArea:{title:"Chat",show:!1,align:"center"},messagesArea:{alternating:!0},inputArea:{show:!0},sendOnEnter:!0,sendOnShiftEnter:!1,instanceClass:"",virtualScrolling:!0,virtualScrollingThreshold:500}),n);"string"==typeof i&&(i=document.querySelector(i)),this._parentElement=i,this._theme=r.theme,this._onSend=s||function(){},this._createWidget(),r.instanceClass&&this._chatWidget.classList.add(r.instanceClass),r.titleArea&&(this.titleAreaSetContents(r.titleArea.title,r.titleArea.align),!0===r.titleArea.show?this.titleAreaShow():this.titleAreaHide()),r.messagesArea&&this.messagesAreaAlternateColors(r.messagesArea.alternating),r.inputArea&&(!0===r.inputArea.show?this.inputAreaShow():this.inputAreaHide()),this._attachEventListeners(),this.trackHistory=r.trackHistory||!0,this._historyLimit=1e7,this._history=[],this._activeTags=new Set,this.sendOnEnter=r.sendOnEnter,this.sendOnShiftEnter=r.sendOnShiftEnter,this.virtualScrollingEnabled=r.virtualScrolling,this.virtualScrollingThreshold=r.virtualScrollingThreshold,this.virtualScroller=null}),[{key:"_initVirtualScrolling",value:function(){var t=this;this.virtualScrollingEnabled&&this._messagesArea&&!this.virtualScroller&&this._history.length>=this.virtualScrollingThreshold-1&&(this.virtualScroller=new c(this._messagesArea,{itemHeight:80,buffer:5,onRenderItem:function(e){t._messagesArea.classList.contains("quikchat-messages-area-alt")&&t._updateMessageStyles()}}),this._migrateToVirtualScrolling())}},{key:"_migrateToVirtualScrolling",value:function(){if(this.virtualScroller){this._messagesArea.innerHTML="";var t=this._history.map((function(t){return{msgid:t.msgid,content:t.content,userString:t.userString,align:t.align,role:t.role,visible:t.visible,tags:t.tags||[],scrollIntoView:!1}}));this.virtualScroller.addItems(t)}}},{key:"_createWidget",value:function(){var t='\n            <div class="quikchat-base '.concat(this.theme,'">\n                <div class="quikchat-title-area">\n                    <span style="font-size: 1.5em; font-weight: 600;">Title Area</span>\n                </div>\n                <div class="quikchat-messages-area"></div>\n                <div class="quikchat-input-area">\n                    <textarea class="quikchat-input-textbox"></textarea>\n                    <button class="quikchat-input-send-btn">Send</button>\n                </div>\n            </div>\n            ');this._parentElement.innerHTML=t,this._chatWidget=this._parentElement.querySelector(".quikchat-base"),this._titleArea=this._chatWidget.querySelector(".quikchat-title-area"),this._messagesArea=this._chatWidget.querySelector(".quikchat-messages-area"),this._inputArea=this._chatWidget.querySelector(".quikchat-input-area"),this._textEntry=this._inputArea.querySelector(".quikchat-input-textbox"),this._sendButton=this._inputArea.querySelector(".quikchat-input-send-btn"),this.msgid=0}},{key:"_attachEventListeners",value:function(){var t=this;this._sendButton.addEventListener("click",(function(e){e.preventDefault(),t._onSend(t,t._textEntry.value.trim())})),window.addEventListener("resize",(function(){return t._handleContainerResize()})),this._chatWidget.addEventListener("resize",(function(){return t._handleContainerResize()})),this._textEntry.addEventListener("keydown",(function(e){e.shiftKey&&13===e.keyCode?t.sendOnShiftEnter&&(e.preventDefault(),t._onSend(t,t._textEntry.value.trim())):13===e.keyCode&&t.sendOnEnter&&(e.preventDefault(),t._onSend(t,t._textEntry.value.trim()))})),this._messagesArea.addEventListener("scroll",(function(){var e=t._messagesArea,i=e.scrollTop,s=e.scrollHeight,n=e.clientHeight;t.userScrolledUp=i+n<s}))}},{key:"setCallbackOnSend",value:function(t){this._onSend=t}},{key:"setCallbackonMessageAdded",value:function(t){this._onMessageAdded=t}},{key:"setCallbackonMessageAppend",value:function(t){this._onMessageAppend=t}},{key:"setCallbackonMessageReplace",value:function(t){this._onMessageReplace=t}},{key:"setCallbackonMessageDelete",value:function(t){this._onMessageDelete=t}},{key:"titleAreaToggle",value:function(){"none"===this._titleArea.style.display?this.titleAreaShow():this.titleAreaHide()}},{key:"titleAreaShow",value:function(){this._titleArea.style.display="",this._adjustMessagesAreaHeight()}},{key:"titleAreaHide",value:function(){this._titleArea.style.display="none",this._adjustMessagesAreaHeight()}},{key:"titleAreaSetContents",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center";this._titleArea.innerHTML=t,this._titleArea.style.textAlign=e}},{key:"titleAreaGetContents",value:function(){return this._titleArea.innerHTML}},{key:"inputAreaToggle",value:function(){this._inputArea.classList.toggle("hidden"),"none"===this._inputArea.style.display?this.inputAreaShow():this.inputAreaHide()}},{key:"inputAreaShow",value:function(){this._inputArea.style.display="",this._adjustMessagesAreaHeight()}},{key:"inputAreaHide",value:function(){this._inputArea.style.display="none",this._adjustMessagesAreaHeight()}},{key:"_adjustMessagesAreaHeight",value:function(){var t=l(this._chatWidget.children).filter((function(t){return t.classList.contains("hidden")})).reduce((function(t,e){return t+e.offsetHeight}),0),e=this._chatWidget.offsetHeight;this._messagesArea.style.height="calc(100% - ".concat(e-t,"px)")}},{key:"_handleContainerResize",value:function(){return this._adjustMessagesAreaHeight(),this._adjustSendButtonWidth(),!0}},{key:"_adjustSendButtonWidth",value:function(){var t=this._sendButton.textContent.trim(),e=parseFloat(getComputedStyle(this._sendButton).fontSize)*t.length+16;return this._sendButton.style.minWidth="".concat(e,"px"),!0}},{key:"messagesAreaAlternateColors",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return t?this._messagesArea.classList.add("quikchat-messages-area-alt"):this._messagesArea.classList.remove("quikchat-messages-area-alt"),!0===t}},{key:"messagesAreaAlternateColorsToggle",value:function(){this._messagesArea.classList.toggle("quikchat-messages-area-alt")}},{key:"messagesAreaAlternateColorsGet",value:function(){return this._messagesArea.classList.contains("quikchat-messages-area-alt")}},{key:"messageAddFull",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{content:"",userString:"user",align:"right",role:"user",userID:-1,timestamp:!1,updatedtime:!1,scrollIntoView:!0,visible:!0,tags:[]},i=this.msgid;this.msgid++;var s=null;if(this.virtualScrollingEnabled&&!this.virtualScroller&&this._history.length>=this.virtualScrollingThreshold-1&&this._initVirtualScrolling(),this.virtualScroller){var n={msgid:i,content:e.content,userString:e.userString,align:e.align,role:e.role,visible:void 0===e.visible||e.visible,tags:e.tags||[],scrollIntoView:e.scrollIntoView};Array.isArray(e.tags)&&e.tags.forEach((function(e){"string"==typeof e&&/^[a-zA-Z0-9-]+$/.test(e)&&t._activeTags.add(e)})),this.virtualScroller.addItem(n),this._textEntry.value="",this._adjustMessagesAreaHeight()}else{s=document.createElement("div");var r="quikchat-msgid-"+String(i).padStart(10,"0");String(e.userString).padStart(10,"0"),s.classList.add("quikchat-message",r,"quikchat-structure"),Array.isArray(e.tags)&&e.tags.forEach((function(e){"string"==typeof e&&/^[a-zA-Z0-9-]+$/.test(e)&&(s.classList.add("quikchat-tag-".concat(e)),t._activeTags.add(e))}));var l=document.createElement("div");l.innerHTML=e.userString,l.classList.add("quikchat-user-label"),l.style.textAlign=e.align;var o=document.createElement("div");if(o.classList.add("quikchat-message-content"),"right"===e.align){var h=e.content.includes("\n"),c=e.content.length>50;h||c?o.classList.add("quikchat-right-multiline"):o.classList.add("quikchat-right-singleline")}o.innerHTML=e.content,s.appendChild(l),s.appendChild(o),this._messagesArea.appendChild(s),!1===e.visible&&(s.style.display="none"),!0===e.scrollIntoView?this.messageScrollToBottom():"smart"!==e.scrollIntoView||this.userScrolledUp||this.messageScrollToBottom(),this._textEntry.value="",this._adjustMessagesAreaHeight(),this._handleShortLongMessageCSS(s,e.align),this._updateMessageStyles()}var u=e.timestamp?e.timestamp:(new Date).toISOString(),g=e.updatedtime?e.updatedtime:u,d=void 0===e.visible||e.visible;return this.trackHistory&&(this._history.push(a(a({msgid:i},e),{},{visible:d,timestamp:u,updatedtime:g,messageDiv:s||null})),this._history.length>this._historyLimit&&this._history.shift()),this._onMessageAdded&&this._onMessageAdded(this,i),i}},{key:"messageAddNew",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"right",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"user",n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];return this.messageAddFull({content:t,userString:e,align:i,role:s,scrollIntoView:n,visible:r,tags:a})}},{key:"messageRemove",value:function(t){var e=!1;try{this._messagesArea.removeChild(this._messagesArea.querySelector(".quikchat-msgid-".concat(String(t).padStart(10,"0")))),e=!0}catch(t){console.log("{String(n)} : Message ID not found")}return e&&(this._history.splice(this._history.findIndex((function(e){return e.msgid===t})),1),this._onMessageDelete&&this._onMessageDelete(this,t)),e}},{key:"messageGetDOMObject",value:function(t){var e=null;try{e=this._messagesArea.querySelector(".quikchat-msgid-".concat(String(t).padStart(10,"0")))}catch(t){console.log("{String(n)} : Message ID not found")}return e}},{key:"messageGetContent",value:function(t){var e="";try{e=this._history.filter((function(e){return e.msgid===t}))[0].content}catch(t){console.log("{String(n)} : Message ID not found")}return e}},{key:"messageGetContentDOMElement",value:function(t){var e=null;try{e=this._history.filter((function(e){return e.msgid===t}))[0].messageDiv.lastChild}catch(t){console.log("{String(n)} : Message ID not found")}return e}},{key:"messageAppendContent",value:function(t,e){var i=!1;try{var s=this._history.filter((function(e){return e.msgid===t}))[0];if(s.content+=e,s.updatedtime=(new Date).toISOString(),this.virtualScroller){var n=this.virtualScroller.items.findIndex((function(e){return e.msgid===t}));n>=0&&(this.virtualScroller.items[n].content+=e,this.virtualScroller.updateItem(n,{content:this.virtualScroller.items[n].content}))}else this._messagesArea.querySelector(".quikchat-msgid-".concat(String(t).padStart(10,"0"))).lastChild.innerHTML+=e;i=!0,this._onMessageAppend&&this._onMessageAppend(this,t,e)}catch(e){console.log("".concat(String(t)," : Message ID not found"))}return i}},{key:"messageReplaceContent",value:function(t,e){var i=!1;try{var s=this._history.filter((function(e){return e.msgid===t}))[0];if(s.content=e,s.updatedtime=(new Date).toISOString(),this.virtualScroller){var n=this.virtualScroller.items.findIndex((function(e){return e.msgid===t}));n>=0&&(this.virtualScroller.items[n].content=e,this.virtualScroller.updateItem(n,{content:e}))}else this._messagesArea.querySelector(".quikchat-msgid-".concat(String(t).padStart(10,"0"))).lastChild.innerHTML=e;i=!0,this._onMessageReplace&&this._onMessageReplace(this,t,e)}catch(e){console.log("".concat(String(t)," : Message ID not found"))}return i}},{key:"messageScrollToBottom",value:function(){this._messagesArea.lastElementChild&&this._messagesArea.lastElementChild.scrollIntoView()}},{key:"messageRemoveLast",value:function(){if(this._history.length>=0){var t=this._history[this._history.length-1].msgid;return this.messageRemove(t)}return!1}},{key:"messageSetVisibility",value:function(t,e){var i=this._history.find((function(e){return e.msgid===t}));return!(!i||!i.messageDiv)&&(i.messageDiv.style.display=e?"":"none",i.visible=e,this._updateMessageStyles(),!0)}},{key:"messageGetVisibility",value:function(t){var e=this._history.find((function(e){return e.msgid===t}));return!(!e||!e.messageDiv)&&"none"!==e.messageDiv.style.display}},{key:"_updateMessageStyles",value:function(){l(this._messagesArea.children).filter((function(t){return"none"!==t.style.display})).forEach((function(t,e){t.classList.remove("quikchat-message-1","quikchat-message-2"),t.classList.add(e%2==0?"quikchat-message-1":"quikchat-message-2")}))}},{key:"_handleShortLongMessageCSS",value:function(t,e){t.classList.remove("left-singleline","left-multiline","center-singleline","center-multiline","right-singleline","right-multiline");var i=t.lastChild;window.lastDiv=i;var s,n=window.getComputedStyle(i),r=i.offsetHeight;"normal"===n.lineHeight?s=1.2*parseFloat(n.fontSize):s=parseFloat(n.lineHeight);var a=r>s;switch(e){case"center":a?t.classList.add("center-multiline"):t.classList.add("center-singleline");break;case"right":a?t.classList.add("right-multiline"):t.classList.add("right-singleline");break;default:a?t.classList.add("left-multiline"):t.classList.add("left-singleline")}}},{key:"historyGet",value:function(t,e){return null==t&&(t=0,e=this._history.length),void 0===e&&(e=t<0?e:t+1),this._history.slice(t,e)}},{key:"historyGetAllCopy",value:function(){return this._history.slice()}},{key:"historyGetPage",value:function(){var t,e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"asc",r=this._history.length,a=Math.ceil(r/s),l=Math.max(1,Math.min(i,a||1));"desc"===n?(t=Math.max(0,r-l*s),e=r-(l-1)*s):(t=(l-1)*s,e=Math.min(t+s,r));var o=this._history.slice(t,e);return"desc"===n&&o.reverse(),{messages:o,pagination:{currentPage:l,pageSize:s,totalPages:a,totalMessages:r,hasNext:l<a,hasPrevious:l>1,order:n}}}},{key:"historySearch",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._history;if(t.text){var i=t.text.toLowerCase();e=e.filter((function(t){return t.content.toLowerCase().includes(i)}))}t.userString&&(e=e.filter((function(e){return e.userString===t.userString}))),t.role&&(e=e.filter((function(e){return e.role===t.role}))),t.tags&&t.tags.length>0&&(e=e.filter((function(e){return e.tags&&e.tags.some((function(e){return t.tags.includes(e)}))})));var s=t.limit||100;return e.length>s&&(e=e.slice(0,s)),e}},{key:"historyGetInfo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,e=this._history.length;return{totalMessages:e,totalPages:Math.ceil(e/t),oldestMessage:e>0?{msgid:this._history[0].msgid,timestamp:this._history[0].timestamp,userString:this._history[0].userString}:null,newestMessage:e>0?{msgid:this._history[e-1].msgid,timestamp:this._history[e-1].timestamp,userString:this._history[e-1].userString}:null,memoryUsage:{estimatedSize:JSON.stringify(this._history).length,averageMessageSize:e>0?Math.round(JSON.stringify(this._history).length/e):0}}}},{key:"historyClear",value:function(){this.msgid=0,this.virtualScroller?this.virtualScroller.clear():this._messagesArea.innerHTML="",this._history=[],this._activeTags.clear()}},{key:"historyGetLength",value:function(){return this._history.length}},{key:"historyGetMessage",value:function(t){return t>=0&&t<this._history.length?this._history[t]:{}}},{key:"historyGetMessageContent",value:function(t){return t>=0&&t<this._history.length?this._history[t].content:""}},{key:"historyRestoreAll",value:function(t){var e=this;this.historyClear(),this._messagesArea.innerHTML="",t.forEach((function(t){e.messageAddFull(t)}))}},{key:"changeTheme",value:function(t){this._chatWidget.classList.remove(this._theme),this._chatWidget.classList.add(t),this._theme=t}},{key:"theme",get:function(){return this._theme}},{key:"setTagVisibility",value:function(t,e){if("string"!=typeof t||!/^[a-zA-Z0-9-]+$/.test(t))return!1;var i="quikchat-show-tag-".concat(t);return e?this._chatWidget.classList.add(i):this._chatWidget.classList.remove(i),this._updateMessageStyles(),!0}},{key:"getTagVisibility",value:function(t){return!("string"!=typeof t||!/^[a-zA-Z0-9-]+$/.test(t))&&this._chatWidget.classList.contains("quikchat-show-tag-".concat(t))}},{key:"getActiveTags",value:function(){return Array.from(this._activeTags)}},{key:"isVirtualScrollingEnabled",value:function(){return this.virtualScrollingEnabled&&null!==this.virtualScroller}},{key:"getVirtualScrollingConfig",value:function(){return{enabled:this.virtualScrollingEnabled,active:null!==this.virtualScroller,threshold:this.virtualScrollingThreshold}}}],[{key:"version",value:function(){return h}},{key:"loremIpsum",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s="Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. ";for("number"!=typeof t&&(t=Math.floor(150*Math.random())+25),void 0===e&&(e=Math.floor(446*Math.random())),e%=446;" "===s[e]||/[.,:;!?]/.test(s[e]);)e=(e+1)%446;var n=s.substring(e)+s.substring(0,e);"number"!=typeof t&&(t=n.length);for(var r="";t>0;)r+=t<n.length?n.substring(0,t):n,t-=n.length;if(" "===r[r.length-1]&&(r=r.substring(0,r.length-1)+"."),i){var a=r[0].toUpperCase();r=(a=/[A-Z]/.test(a)?a:"M")+r.substring(1)}return r}},{key:"tempMessageGenerator",value:function(t,e,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i=Math.max(i,100);var n=0;s&&"function"!=typeof s&&(s=null),s=s||function(t,e){return t+="."};var r=t;"string"==typeof r&&(r=document.querySelector(r));var a=r;if(a){a.innerHTML=e;var l=e,o=setInterval((function(){a.innerHTML===l?(l=String(s(l,n)),n++,a.innerHTML=l):clearInterval(o)}),i)}}},{key:"createTempMessageDOMStr",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=Math.max(e,100),i&&"function"!=typeof i&&(i=null),i=i||function(t,e){return t+"."};var n=s.containerClass?s.containerClass:"",r="tempMsg_"+Date.now()+"_"+Math.floor(1e6*Math.random());return'\n          <span id="'.concat(r,'" ').concat(n?'class="'.concat(n,'"'):"",">\n            ").concat(t,'\n          </span>\n          <script>\n            (function(){\n              // Get our container element by its unique id.\n              var container = document.getElementById("').concat(r,'");\n              if (!container) return;\n              var count = 0;\n              var currentMsg = container.innerHTML;\n              var interval = ').concat(e,";\n              // Convert the callback function into its string representation.\n              var cb = ").concat(i.toString(),";\n              var intervalId = setInterval(function(){\n                // If the content has been replaced, stop updating.\n                if(container.innerHTML !== currentMsg){\n                  clearInterval(intervalId);\n                  return;\n                }\n                // Use the callback to generate the new message.\n                currentMsg = String(cb(currentMsg, count));\n                count++;\n                container.innerHTML = currentMsg;\n              }, interval);\n            })();\n          <\/script>\n        ")}}])}();module.exports=u;
//# sourceMappingURL=quikchat.cjs.min.js.map
